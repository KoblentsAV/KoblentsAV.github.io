<!DOCTYPE HTML>
<html>

<head>
  <title>test pay widget</title>
  <meta charset="UTF-8">
  <link href="style.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous">
  </script>
  <script src="https://widget.cloudpayments.ru/bundles/checkout"></script>
</head>

<body>
  <div class="area">
    <ul class="circles">
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
      <li></li>
    </ul>
  </div>
  <input type="checkbox" id="recurrent-sample-3">
  <div class="btn" id="payBtn">
    <p>Классический</p>
  </div>
  <div class="btn btn--mini" id="payBtn2">
    <p>Минимальный</p>
  </div>
  <div class="btn btn--modern" id="payBtn3">
    <p>Модерн</p>
  </div>
  <div class="btn btn--test" id="payBtn4">
    <p>ТЕСТ</p>
  </div>
  <div class="checkout-wrapper">
    <form class="checkout-cp" id="paymentFormSample" autocomplete="off" method="GET">
      <input type="text" data-cp="cardNumber" placeholder="cardNumber">
      <input type="text" data-cp="expDateMonth" placeholder="expDateMonth">
      <input type="text" data-cp="expDateYear" placeholder="expDateYear">
      <input type="text" data-cp="cvv" placeholder="cvv">
      <input type="text" data-cp="name" placeholder="name">
      <button type="submit">Оплатить 100 р.</button>
    </form>
  </div>
  <script src="script.js"></script>
  <script>
  this.createCryptogram = function () {
    var result = checkout.createCryptogramPacket();

    if (result.success) {
        // сформирована криптограмма
        alert(result.packet);
    }
    else {
        // найдены ошибки в введённых данных, объект `result.messages` формата:
        // { name: "В имени держателя карты слишком много символов", cardNumber: "Неправильный номер карты" }
        // где `name`, `cardNumber` соответствуют значениям атрибутов `<input ... data-cp="cardNumber">`
       for (var msgName in result.messages) {
           alert(result.messages[msgName]);
       }
    }
};

$(function () {
    /* Создание checkout */
    checkout = new cp.Checkout(
    // public id из личного кабинета
    "pk_e5450f37312698f63920b12f4be44",
    // тег, содержащий поля данных карты
    document.getElementById("paymentFormSample"));
});

    this.payBtn = function() {
      var widget = new cp.CloudPayments();

      var data = {};
    var auto = $('#recurrent-sample-3').is(':checked'); //проверка

    if (auto) { //включаем подписку

      var date = new Date();
      date.toUTCString();

        var recurrent = { interval: 'Month', period: 1, startDate: date }; //один раз в месяц начиная со следующего месяца за минусом одного дня
        data.cloudPayments = {
            recurrent: recurrent
        }
    }

    var amount = parseFloat($('#amount-sample-3').val());
    var accountId = $('#account-sample-3').val();

      var receipt = {
        "Items": [{
            "label": "Наименование товара 3", //наименование товара
            "price": 300.00, //цена
            "quantity": 3.00, //количество
            "amount": 900.00, //сумма
            "vat": 20, //ставка НДС
            "method": 0, // тег-1214 признак способа расчета - признак способа расчета
            "object": 0, // тег-1212 признак предмета расчета - признак предмета товара, работы, услуги, платежа, выплаты, иного предмета расчета
            "measurementUnit": "шт", //единица измерения
            "AgentSign": 0, //признак агента, тег ОФД 1057, 1222
            "AgentData": { //данные агента, тег офд 1223
                  "AgentOperationName": "CloudPayments", // наименование операции банковского платежного агента или банковского платежного субагента, тег ОФД 1044
                  "PaymentAgentPhone": null, // телефон платежного агента, тег ОФД 1073
                  "PaymentReceiverOperatorPhone": null, // телефон оператора по приему платежей, тег ОФД 1074
                  "TransferOperatorPhone": null, // телефон оператора перевода, тег ОФД 1075
                  "TransferOperatorName": null, // наименование оператора перевода, тег ОФД 1026
                  "TransferOperatorAddress": null, // адрес оператора перевода, тег ОФД 1005
                  "TransferOperatorInn": null // ИНН оператора перевода, тег ОФД 1016
                },
                "PurveyorData": { //данные поставщика платежного агента,  тег ОФД 1224
                    "Phone": "+74951234567", // телефон поставщика, тег ОД 1171
                    "Name": "ООО Ромашка", // наименование поставщика, тег ОФД 1225
                    "Inn": "1234567890" // ИНН поставщика, тег ОФД 1226
          }
        },
          {
            "label": 'Название услуги 2',
            "price": 100.00,
            "quantity": 1.00,
            "amount": 100.00,
            "measurementUnit": "шт"
          }],
        "email": "koblents1945@gmail.com",
        "phone": "",
        "amounts": {
          "electronic": 1000.00
        }
      }

    // var data = { //содержимое элемента data
    //  "cloudPayments": {
    //    "customerReceipt": receipt, //онлайн-чек
    //  }
//  }

      widget.charge({
          publicId: 'pk_e5450f37312698f63920b12f4be44',
          description: 'Оплата заказа №187163Оплатазаказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163Оплата заказа №187163',
          amount: 1000,
          currency: 'RUB',
          email: "",
          requireEmail: true,
          invoiceId: "1234567",
          accountId: "koblents1945@gmail.com",
          data: data
        },
        function(options) {

        },
        function(reason, options) {

        });
    };

    this.payBtn2 = function() {
      var widget = new cp.CloudPayments();

      widget.auth({
          publicId: 'pk_e5450f37312698f63920b12f4be44',
          description: 'Оплата заказа №187163',
          amount: 2100,
          currency: 'RUB',
          email: "test@test.ru",
          requireEmail: true,
          invoiceId: "1234567",
          accountId: "ЛЯЛЯЛЯЛЯЛ",
          skin: 'mini'
        },
        function(options) {

        },
        function(reason, options) {

        });
    };

    this.payBtn3 = function() {
    var widget = new cp.CloudPayments({googlePaySupport: false});
    widget.charge({ // options
    publicId: 'pk_e5450f37312698f63920b12f4be44', //id из личного кабинета
    description: 'Оплата заказа #10061947', //назначение
    amount: 214, //сумма
    requireEmail: true,
    currency: 'RUB', //валюта
    invoiceId: '10061947', //номер заказа (необязательно)
    accountId: 'koblents1945@gmail.com',//идентификатор плательщика (необязательно)
    skin: 'modern',
    data : {"cloudPayments":{"CustomerReceipt":{"Items":[{"label":"\u041e\u043f\u043b\u0430\u0442\u0430 \u043b\u0438\u0437\u0438\u043d\u0433\u043e\u0432\u043e\u0433\u043e \u043f\u043b\u0430\u0442\u0435\u0436\u0430",
    "price":"100","amount":"100","quantity":1,"vat":0,"method":0,"object":10}],
    "calculationPlace":"www.natcredit.ru","email":"koblents1945@gmail.com","phone":"","isBso": false,"amounts":{"electronic":"100","advancePayment":0,"credit":0,"provision":0}}}}
  },
    function (options) { // success
    //действие при успешной оплате
    },
    function (reason, options) { // fail
    //действие при неуспешной оплате
  });
};

    //вызов виджета
    $('#payBtn').click(payBtn);
    $('#payBtn2').click(payBtn2);
    $('#payBtn3').click(payBtn3);

    //тест кода
  </script>
</body>
</html>
